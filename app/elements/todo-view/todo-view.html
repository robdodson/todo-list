<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<!-- Iron elements -->
<link rel="import" href="../../bower_components/iron-flex-layout/classes/iron-flex-layout.html">
<link rel="import" href="../../bower_components/iron-pages/iron-pages.html">

<!-- Paper elements -->
<link rel="import" href="../../bower_components/paper-drawer-panel/paper-drawer-panel.html">
<link rel="import" href="../../bower_components/paper-header-panel/paper-header-panel.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/paper-menu/paper-menu.html">
<link rel="import" href="../../bower_components/paper-toolbar/paper-toolbar.html">

<!-- Add your elements here -->
<link rel="import" href="../../styles/app-theme.html">
<link rel="import" href="../todo-data/todo-data.html">
<link rel="import" href="../todo-list/todo-list.html">
<link rel="import" href="../todo-input/todo-input.html">
<link rel="import" href="../todo-icons/todo-icons.html">


<dom-module id="todo-view">
  <style is="custom-style" include="app-theme"></style>
  <style>
    :host {
      display: block;
    }

    #drawerToolbar {
      color: var(--secondary-text-color);
      background-color: var(--drawer-menu-color);
      border-bottom: var(--drawer-toolbar-border-color);
    }

    iron-pages {
      padding: 48px 16px;
    }

    paper-material {
      border-radius: 2px;
      height: 100%;
      padding: 16px 0 16px 0;
      width: calc(98.66% - 16px);
      margin: 16px auto;
      background: white;
    }

    paper-menu iron-icon {
      margin-right: 33px;
      opacity: 0.54;
    }

    .paper-menu > .iron-selected {
      color: var(--default-primary-color);
    }

    paper-menu a {
      text-decoration: none;
      color: var(--menu-link-color);
      display: -ms-flexbox;
      display: -webkit-flex;
      display: flex;
      -ms-flex-direction: row;
      -webkit-flex-direction: row;
      flex-direction: row;
      -ms-flex-align: center;
      -webkit-align-items: center;
      align-items: center;
      font-family: var(--default-font-family);
      -webkit-font-smoothing: antialiased;
      text-rendering: optimizeLegibility;
      font-size: 14px;
      font-weight: 400;
      line-height: 24px;
      min-height: 48px;
      padding: 0 16px;
    }

    #mainToolbar .middle-container {
      height: 100%;
      margin-left: 48px;
    }

    #mainToolbar:not(.tall) .middle {
      font-size: 18px;
      padding-bottom: 0;
    }

    .app-name {
      font-family: 'Roboto Slab', 'Roboto', 'Helvetica', 'Arial', sans-serif;
      font-weight: bold;
    }

    .clear-btn:hover,
    .clear-btn:focus {
      background-color: var(--text-primary-color);
      color: var(--default-primary-color);
    }

    /* Height of the scroll area */
    .content {
      height: 900px;
    }

    /* Breakpoints */

    /* Small */
    @media (max-width: 600px) {

      paper-material {
        --menu-container-display: none;
        width: calc(97.33% - 32px);
        padding-left: 16px;
        padding-right: 16px;
      }

      .paper-font-display1 {
        font-size: 12px;
      }

      #drawer .paper-toolbar {
        margin-left: 16px;
      }

      #overlay {
        min-width: 360px;
      }

      .bg {
        background: white;
      }

    }

    /* Tablet+ */
    @media (min-width: 601px) {

      html {
        font-size: 20px;
      }

      #drawer.paper-drawer-panel > [drawer] {
        border-right: 1px solid rgba(0, 0, 0, 0.14);
      }

      iron-pages {
        padding: 48px 62px;
      }

      paper-material {
        width: calc(98% - 46px);
        margin-bottom: 32px;
        padding-left: 30px;
        padding-right: 30px;
      }

    }
  </style>
  <template>

    <todo-data location="https://polymer-todo.firebaseio.com"
               todos="{{todos}}">
    </todo-data>

    <paper-drawer-panel id="paperDrawerPanel">
      <div drawer>

        <!-- Drawer Toolbar -->
        <paper-toolbar id="drawerToolbar"></paper-toolbar>

        <!-- Drawer Content -->
        <paper-menu class="list" attr-for-selected="data-route" selected="{{route}}">
          <!-- Give anchors a tabindex to work around https://github.com/PolymerElements/iron-menu-behavior/issues/19 -->
          <a data-route="all" href="/" tabindex="-1">
            <iron-icon icon="todo-icons:assignment"></iron-icon>
            <span>All Todos</span>
          </a>

          <a data-route="active" href="/active" tabindex="-1">
            <iron-icon icon="todo-icons:assignment-late"></iron-icon>
            <span>Active</span>
          </a>

          <a data-route="completed" href="/completed" tabindex="-1">
            <iron-icon icon="todo-icons:assignment-turned-in"></iron-icon>
            <span>Completed</span>
          </a>
        </paper-menu>
      </div>
      <paper-header-panel main>

        <!-- Main Toolbar -->
        <paper-toolbar id="mainToolbar">
          <paper-icon-button id="paperToggle" icon="todo-icons:menu" paper-drawer-toggle></paper-icon-button>
          <span class="flex"></span>

          <!-- Application name -->
          <div class="middle middle-container center horizontal layout flex">

            <div class="app-name flex">Todos</div>

            <paper-button class="clear-btn"
                          on-tap="clearCompletedTodos">
              Clear Completed
            </paper-button>

            <iron-icon icon="todo-icons:account-circle"
                       on-tap="signOut">
            </iron-icon>

          </div>

        </paper-toolbar>

        <!-- Main Content -->
        <div class="content">
          <todo-list todos="[[todos]]"
                     filter-by="[[route]]"
                     on-delete-todo="deleteTodo">
          </todo-list>
          <todo-input on-add-todo="addTodo"></todo-input>
        </div>
      </paper-header-panel>
    </paper-drawer-panel>
  </template>
  <script>
    Polymer({

      is: 'todo-view',

      properties: {

        route: String,

        todos: Object

      },

      // Add todo to Firebase
      addTodo: function(e, detail) {
        this.todos = this.todos.concat({
          label: detail.value,
          isComplete: false
        });
      },

      // Remove todo from Firebase usings its unique ID
      deleteTodo: function(e) {
        var uid = e.detail.uid;
        this.todos = this.todos.filter(function(todo) {
          return todo.uid !== uid;
        });
      },

      // Toggle isComplete state of todo in Firebase using its unique ID
      toggleTodo: function(e) {
        var uid = e.detail.uid;
        var isComplete = e.detail.isComplete;
        this.todos = this.todos.map(function(todo) {
          return todo.uid !== uid ? todo : (todo.isComplete = isComplete);
        });
      },

      // Find todo by index, then update its label value in Firebase
      editTodo: function(e) {
        var uid = e.detail.uid;
        var label = e.detail.label;
        this.todos = this.todos.map(function(todo) {
          return todo.uid !== uid ? todo : (todo.label = label);
        });
      },

      // Remove all completed todos from Firebase
      clearCompletedTodos: function() {
        this.todos = this.todos.filter(function(todo) {
          return !todo.isComplete;
        });
      },

    });
  </script>
</dom-module>
